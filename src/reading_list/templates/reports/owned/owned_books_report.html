<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owned Books Gallery</title>
    <style>
        :root {
            --kindle-color: #0066CC;
            --physical-color: #6B4BA3;
            --audio-color: #FF6600;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .media-filters {
            display: flex;
            gap: 10px;
        }

        .filter-button {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            background-color: transparent;
            border: 2px solid;
        }

        /* Media-specific colors - Default state */
        .filter-button.kindle {
            color: #0066CC;
            border-color: #0066CC;
        }

        .filter-button.hardcover {
            color: #6B4BA3;
            border-color: #6B4BA3;
        }

        .filter-button.audio {
            color: #FF6600;
            border-color: #FF6600;
        }

        /* Active states - Filled background */
        .filter-button[data-active="true"].kindle {
            background-color: #0066CC;
            color: white;
            border-color: #0066CC;
        }

        .filter-button[data-active="true"].hardcover {
            background-color: #6B4BA3;
            color: white;
            border-color: #6B4BA3;
        }

        .filter-button[data-active="true"].audio {
            background-color: #FF6600;
            color: white;
            border-color: #FF6600;
        }

        /* Status filter styles */
        .filter-button.status {
            color: #0066CC;
            border-color: #0066CC;
        }

        .filter-button[data-active="true"].status {
            background-color: #0066CC;
            color: white;
        }

        /* Hover effects */
        .filter-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Filter group layout */
        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .media-filters {
            display: flex;
            gap: 10px;
        }

        .stats {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            padding: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .book-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .book-card:hover {
            transform: translateY(-5px);
        }

        .cover-container {
            position: relative;
            padding-top: 150%; /* 2:3 aspect ratio */
            width: 100%;
        }

        .cover-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-info {
            padding: 15px;
        }

        .book-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .book-author {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #666;
        }

        .book-series {
            margin: 5px 0;
            font-size: 0.8rem;
            color: #888;
        }

        /* Format badges */
        .format-badges {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;  /* Changed to column for vertical stacking */
            gap: 5px;
            z-index: 2;
        }

        .format-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
        }

        .format-badge.physical {
            background-color: #3b82f6;
        }

        .format-badge.kindle {
            background-color: #10b981;
        }

        .format-badge.audio {
            background-color: #8b5cf6;
        }

        /* Reading status badge */
        .reading-status-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            z-index: 2;
            max-width: 40%;  /* Prevent overlap with format badges */
        }

        .reading-status-badge.read {
            background-color: #22c55e;
        }

        .reading-status-badge.unread {
            background-color: #64748b;
        }

        /* Filter buttons */
        .filters {
            padding: 20px 20px 0 20px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .filter-button {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid;
            background: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .filter-button:hover {
            opacity: 0.8;
        }

        .filter-button.status {
            border-color: #64748b;
            color: #64748b;
        }

        .filter-button.status.active {
            background-color: #64748b;
            color: white;
        }

        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .book-title {
                font-size: 0.9rem;
            }

            .book-author {
                font-size: 0.8rem;
            }

            .format-badge {
                font-size: 0.6rem;
                padding: 3px 6px;
            }

            .reading-status-badge {
                font-size: 0.7rem;
                padding: 3px 6px;
            }

            .format-badges {
                bottom: 10px;
                right: 5px;
            }

            .format-badge {
                font-size: 0.6rem;
                padding: 3px 6px;
            }

            .reading-status-badge {
                font-size: 0.7rem;
                padding: 3px 6px;
                left: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Owned Books Gallery</h1>
    </div>

    <div class="filters">
        <div class="filter-group">
            <button class="filter-button status" data-status="read">Read</button>
            <div class="media-filters">
                <button class="filter-button media hardcover" data-format="physical">Physical</button>
                <button class="filter-button media kindle" data-format="kindle">Kindle</button>
                <button class="filter-button media audio" data-format="audio">Audio</button>
            </div>
            <button class="filter-button status" data-status="unread">Unread</button>
        </div>
    </div>

    <div class="stats">
        <h2>Library Statistics</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ total_books }}</div>
                <div class="stat-label">Total Books</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ total_read }}</div>
                <div class="stat-label">Books Read</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ "{:,}".format(total_pages) }}</div>
                <div class="stat-label">Total Pages</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ "{:,}".format(total_words) }}</div>
                <div class="stat-label">Total Words</div>
            </div>
        </div>
    </div>

    <div class="books-grid">
        {% for book in books %}
        <div class="book-card" 
             data-formats="{{ book.formats|map(attribute='type')|join(' ') }}"
             data-status="{{ 'read' if book.is_read else 'unread' }}">
            <div class="cover-container">
                <img class="cover-img" src="{{ book.cover_url }}" alt="{{ book.title }} cover">
                <div class="reading-status-badge {{ 'read' if book.is_read else 'unread' }}">
                    {{ 'Read' if book.is_read else 'Unread' }}
                </div>
                <div class="format-badges">
                    {% for format in book.formats %}
                        <span class="format-badge {{ format.type }}">{{ format.type|title }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="book-info">
                <h3 class="book-title">{{ book.title }}</h3>
                <p class="book-author">{{ book.author }}</p>
                {% if book.series %}
                <p class="book-series">{{ book.series }} #{{ "%.1f"|format(book.series_number) }}</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusFilters = document.querySelectorAll('.filter-button.status');
            const mediaFilters = document.querySelectorAll('.filter-button.media');
            const books = document.querySelectorAll('.book-card');

            function updateVisibility() {
                const activeStatus = document.querySelector('.filter-button.status[data-active="true"]')?.dataset.status;
                const activeFormat = document.querySelector('.filter-button.media[data-active="true"]')?.dataset.format;

                books.forEach(book => {
                    const matchesStatus = !activeStatus || book.dataset.status === activeStatus;
                    const matchesFormat = !activeFormat || book.dataset.formats.includes(activeFormat);
                    book.style.display = (matchesStatus && matchesFormat) ? '' : 'none';
                });
            }

            statusFilters.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.dataset.active === "true") {
                        btn.dataset.active = "false";
                    } else {
                        statusFilters.forEach(b => b.dataset.active = "false");
                        btn.dataset.active = "true";
                    }
                    updateVisibility();
                });
            });

            mediaFilters.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.dataset.active === "true") {
                        btn.dataset.active = "false";
                    } else {
                        mediaFilters.forEach(b => b.dataset.active = "false");
                        btn.dataset.active = "true";
                    }
                    updateVisibility();
                });
            });
        });
    </script>
</body>
</html>